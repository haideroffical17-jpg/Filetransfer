<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live File Share App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f7f6;
            margin: 0;
        }
        .container {
            display: flex;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 90%;
            max-width: 1200px;
        }
        .panel {
            flex: 1;
            padding: 30px;
            text-align: center;
            border-right: 1px solid #eee;
        }
        .panel:last-child {
            border-right: none;
        }
        h2 {
            color: #333;
            margin-bottom: 25px;
        }
        .drop-area {
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 40px 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .drop-area.highlight {
            background-color: #e6f2ff;
        }
        .drop-area p {
            color: #007bff;
            margin: 0;
            font-size: 1.1em;
        }
        input[type="file"] {
            display: none;
        }
        .file-list {
            text-align: left;
            margin-bottom: 20px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }
        .file-list div {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-list div:last-child {
            border-bottom: none;
        }
        .file-name {
            font-weight: bold;
            color: #555;
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .file-size {
            color: #888;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
            height: 10px; /* Fixed height */
        }
        .progress-bar {
            height: 100%;
            background-color: #28a745;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        .button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            text-decoration: none; /* For download link */
            display: inline-block;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .code-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #28a745;
            margin: 20px 0;
            letter-spacing: 3px;
            user-select: all; /* Allows easy selection */
            cursor: pointer;
        }
        .input-group {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .input-group input {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1.1em;
            width: 180px;
            margin-right: 10px;
            text-align: center;
        }
        .status-message {
            margin-top: 20px;
            font-size: 1.1em;
            color: #555;
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
        }
        .download-link {
            display: block;
            margin-top: 20px;
            font-size: 1.1em;
            color: #007bff;
            text-decoration: underline;
            cursor: pointer;
        }
        .download-link:hover {
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h2>Send File</h2>
            <div id="dropArea" class="drop-area">
                <p>Drag & Drop Files Here</p>
                <p>or</p>
                <button class="button" onclick="document.getElementById('fileInput').click()">Browse Files</button>
                <input type="file" id="fileInput" multiple>
            </div>
            <div id="fileList" class="file-list">
                <!-- Uploaded files will be listed here -->
            </div>
            <div class="progress-bar-container">
                <div id="uploadProgressBar" class="progress-bar"></div>
            </div>
            <button id="generateCodeBtn" class="button" disabled>Generate Share Code</button>
            <div id="shareCodeDisplay" class="code-display" title="Click to copy code"></div>
            <p class="status-message" id="senderStatus">Waiting for files...</p>
        </div>

        <div class="panel">
            <h2>Receive File</h2>
            <div class="input-group">
                <input type="text" id="receiverCodeInput" placeholder="Enter 6-digit code" maxlength="6">
                <button id="connectBtn" class="button">Connect</button>
            </div>
            <p class="status-message" id="receiverStatus">Enter code to connect...</p>
            <p class="error-message" id="receiverError"></p>
            <div id="downloadProgressContainer" class="progress-bar-container" style="display: none;">
                <div id="downloadProgressBar" class="progress-bar"></div>
            </div>
            <a id="downloadLink" class="button" style="display: none;" download="transferred_files.zip">Download All Files</a>
            <p class="status-message" id="downloadCompleteMessage" style="display: none; color: #28a745; font-weight: bold;">Download Complete!</p>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const generateCodeBtn = document.getElementById('generateCodeBtn');
        const shareCodeDisplay = document.getElementById('shareCodeDisplay');
        const senderStatus = document.getElementById('senderStatus');

        const receiverCodeInput = document.getElementById('receiverCodeInput');
        const connectBtn = document.getElementById('connectBtn');
        const receiverStatus = document.getElementById('receiverStatus');
        const receiverError = document.getElementById('receiverError');
        const downloadLink = document.getElementById('downloadLink');
        const downloadProgressContainer = document.getElementById('downloadProgressContainer');
        const downloadProgressBar = document.getElementById('downloadProgressBar');
        const downloadCompleteMessage = document.getElementById('downloadCompleteMessage');

        let uploadedFiles = []; // To store file objects
        let currentShareCode = ''; // Store the generated code

        // --- Sender Side Logic ---

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // For whole document
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Highlight drop area when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
        });

        // Handle dropped files
        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        // Handle files selected via input
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            uploadedFiles = []; // Clear previous files for this simplified example
            fileList.innerHTML = ''; // Clear file list display
            if (files.length === 0) {
                generateCodeBtn.disabled = true;
                senderStatus.textContent = "Waiting for files...";
                return;
            }

            senderStatus.textContent = `Processing ${files.length} file(s)...`;
            generateCodeBtn.disabled = false;
            uploadProgressBar.style.width = '0%';

            for (const file of files) {
                uploadedFiles.push(file); // Store file object
                const fileSize = (file.size / 1024 / 1024).toFixed(2); // MB
                const fileEntry = document.createElement('div');
                fileEntry.innerHTML = `<span class="file-name">${file.name}</span><span class="file-size">(${fileSize} MB)</span>`;
                fileList.appendChild(fileEntry);
            }
            simulateUploadProgress();
        }

        function simulateUploadProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                uploadProgressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(interval);
                    senderStatus.textContent = "Files ready for sharing. Generate code.";
                }
            }, 100);
        }

        generateCodeBtn.addEventListener('click', () => {
            if (uploadedFiles.length > 0) {
                currentShareCode = generateSixDigitCode();
                shareCodeDisplay.textContent = currentShareCode;
                senderStatus.textContent = `Share this code: ${currentShareCode}`;
                // In a real app, send this code and file metadata to your backend
            } else {
                alert("Please upload files first.");
            }
        });

        shareCodeDisplay.addEventListener('click', () => {
            if (currentShareCode) {
                navigator.clipboard.writeText(currentShareCode).then(() => {
                    alert('Code copied to clipboard!');
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                });
            }
        });

        function generateSixDigitCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        // --- Receiver Side Logic ---

        connectBtn.addEventListener('click', () => {
            const enteredCode = receiverCodeInput.value.toUpperCase().trim();
            receiverError.textContent = ''; // Clear previous errors
            downloadLink.style.display = 'none'; // Hide download link
            downloadProgressContainer.style.display = 'none'; // Hide download progress
            downloadCompleteMessage.style.display = 'none'; // Hide complete message

            if (enteredCode.length !== 6) {
                receiverError.textContent = "Please enter a valid 6-digit code.";
                return;
            }

            receiverStatus.textContent = `Attempting to connect with code: ${enteredCode}...`;
            simulateConnectionAndDirectDownload(enteredCode);
        });

        function simulateConnectionAndDirectDownload(code) {
            // Simulate a server check
            setTimeout(() => {
                if (code === currentShareCode && currentShareCode !== '') {
                    receiverStatus.textContent = "Connected! Initiating download...";
                    downloadProgressContainer.style.display = 'block';
                    simulateDownloadProgress(); // Direct download starts here
                } else {
                    receiverError.textContent = "Invalid or expired code. Please try again.";
                    receiverStatus.textContent = "Enter code to connect...";
                }
            }, 1000); // Simulate network delay
        }

        function simulateDownloadProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                downloadProgressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(interval);
                    receiverStatus.textContent = "Download preparation complete.";
                    // This is where a real download link would be provided by a backend
                    // For demo, we create a dummy link.
                    const dummyBlob = new Blob(["This is a dummy file content for demonstration."], { type: "text/plain" });
                    const dummyUrl = URL.createObjectURL(dummyBlob);
                    downloadLink.href = dummyUrl;
                    downloadLink.style.display = 'block';
                    downloadCompleteMessage.style.display = 'block';
                    // Optional: Automatically click the download link
                    // downloadLink.click();
                    // URL.revokeObjectURL(dummyUrl); // Clean up after download

                    // In a real app, the backend would send actual file(s)
                }
            }, 150);
        }

    </script>
</body>
</html>
